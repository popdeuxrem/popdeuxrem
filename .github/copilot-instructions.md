# GitHub Copilot instructions ‚Äî popdeuxrem (Quantum Surface)

Purpose: Give a coding agent immediate, concrete context so it can make safe, deterministic edits and author effective changes.

## Quick summary
- Canonical output: `README.md` is auto-generated by `scripts/update_readme.py` and should be treated as a build artifact, not hand-edited. ‚úÖ
- Visual assets are generated to `assets/*.svg` by the design engine (`scripts/design_engine.py`). Do not manually edit `assets/` files.
- Telemetry & audit outputs live in `dist/` (e.g., `dist/telemetry_data.json`, `dist/security-report.json`).
- CI runner: `.github/workflows/quantum-sync.yml` runs every 12 hours and uses Python 3.12. The workflow exports `GITHUB_TOKEN` to generate telemetry and push changes only when diffs exist.

## When you modify code, follow these patterns
- If you change presentation or content that belongs in the README, update the generator: change `scripts/design_engine.py` or `scripts/update_readme.py`, then run `python3 scripts/update_readme.py` or `bash scripts/build.sh` locally to regenerate files.
- Use `dist/` for ephemeral outputs. If a change touches the format of `dist/*.json`, ensure downstream generators (e.g., README text or `docs/deployments`) consume the new shape.
- Preserve deterministic behavior: `scripts/update_readme.py` uses a daily pseudo-hash (see `get_pseudo_hash()`); avoid introducing nondeterminism unless intentionally necessary.

## Key files and their roles (examples)
- `scripts/update_readme.py` ‚Äî orchestrates generation steps and writes `README.md`.
  - Example: runs `gen_*()` functions from `scripts/design_engine.py` then writes README with a build hash and timestamp.
- `scripts/design_engine.py` ‚Äî creates `assets/section_*.svg` via `write_svg()` helpers. Add or modify `gen_*()` functions to change visual sections.
- `scripts/discovery.py` ‚Äî collects GitHub metadata (uses optional `GITHUB_TOKEN`) and writes `dist/telemetry_data.json`.
- `scripts/generate_vessel_reports.py` ‚Äî writes per-repo markdown in `docs/deployments/` and an `INDEX.md`.
- `scripts/vuln_scan.sh` ‚Äî uses `pip-audit` to populate `dist/security-report.json`; the workflow includes `pip install pip-audit` and runs this as part of CI.

## Developer workflows (exact commands)
- Quick local build: `bash scripts/build.sh` (sets exec bits, runs cleanup if present, and regenerates `README.md`). üîß
- Run discovery (needs `GITHUB_TOKEN` for accurate results): `GITHUB_TOKEN=ghp_xxx python3 scripts/discovery.py` or import `fetch_github_metrics()` in interactive session.
- Generate vessel reports: `python3 scripts/generate_vessel_reports.py` ‚Üí outputs `docs/deployments/*.md` and `docs/deployments/INDEX.md`.
- Security scan (local): `bash scripts/vuln_scan.sh` ‚Üí outputs `dist/audit_raw.json` and `dist/security-report.json`.

## Conventions & gotchas (observed internals)
- Generated artifacts are treated as build outputs and are ignored by scheduled pushes when unchanged (workflow only commits if `git diff --cached` shows changes).
- Scripts expect `dist/`, `assets/`, and `docs/deployments/` to be writable; create them with `os.makedirs(..., exist_ok=True)` when adding new generators.
- Data-shape mismatch: `scripts/discovery.py` returns repo dictionaries with keys like `stars`/`forks`, while `scripts/generate_vessel_reports.py` expects `stargazers_count` and `forks_count`. If you modify data producers or consumers, ensure these keys are reconciled (common bug source).
- `skills.json` can be either a dict (category ‚Üí list) or a list; `scripts/discovery.py::render_skill_bars()` handles both but expect inconsistent shapes in changes.
- CI expects Python 3.12; when adding new dependencies, update `requirements.txt` and ensure `pip install -r requirements.txt` succeeds on the CI matrix.

## Safe edit checklist for agents
1. If the change affects `README.md` content, update the generator (not `README.md` directly). Reference: `scripts/update_readme.py` and `scripts/design_engine.py`. ‚úÖ
2. Run `bash scripts/build.sh` locally and validate outputs in `assets/` and `dist/`. ‚úÖ
3. If adding or changing telemetry or audit output shapes, update any consumer (`README` generation, `generate_vessel_reports.py`, CI push logic). ‚úÖ
4. Add a short note in `docs/ARCHITECTURE.md` if you introduce new runtime components or scheduled tasks. Keep notes factual and discoverable. ‚úÖ

## Questions for maintainers (if needed)
- Should `generate_vessel_reports.py` be updated to use the `stars`/`forks` keys returned by `discovery.py` or should `discovery.py` be changed to use `stargazers_count`/`forks_count`? (Current mismatch is a source of silent errors.)
- Confirm whether `dist/` artifacts should ever be committed manually, or always be produced by CI.

## Copilot CLI & local tooling ‚öôÔ∏è
- Copilot CLI quick-start: `gh extension install github/gh-copilot` and `gh auth login --web -p read:user,repo,workflow`.
- Local quick-build (safe): `export PYTHONPATH=$PWD/scripts && bash scripts/update_readme.sh --dry-run` to verify changes, then run without `--dry-run` to commit.
- To inline external assets safely: use `scripts/fetch_external_images.py` which downloads external images into `assets/` and updates `README.md` (creates `README.md.bak`). Use as a one-off; prefer adding images to `assets/` and referencing them in generators. The script supports `--max-size-kb` (limits download size) and `--dry-run`. Avoid running this script in CI unless you explicitly whitelist sources.
- New helper scripts added:
  - `scripts/update_readme.sh` ‚Äî safe wrapper that regenerates README and commits only when diffs exist (supports `--dry-run`).
  - `scripts/fetch_external_images.py` ‚Äî utility to fetch external images into `assets/` and update README references. Use `--dry-run` to preview changes and `--max-size-kb` to cap downloads.

---
If any of the above is unclear or if you want a different level of detail (e.g., examples for making a new generator), tell me which area to expand. ‚ú®